# RPMツール

RPM（Red Hat Package Manager）は[[Red Hat]]系[[Linux]]ディストリビューション（[[CentOS]]、[[Fedora]]、[[RHEL]]など）で利用される低レベルなパッケージ管理ツールです。バイナリパッケージ（.rpm）のインストール、アップグレード、削除、検証、クエリを行います。[[Debian]]系の[[dpkg]]に相当するRed Hat系のパッケージ管理システムで、[[yum]]や[[dnf]]などの高レベル[[パッケージマネージャ]]の基盤として動作します。

RPMパッケージは依存関係の情報を含んでいますが、rpm コマンド自体は依存関係の自動解決を行わないため、通常は[[yum]]や[[dnf]]と組み合わせて使用されます。

## RPMパッケージの構造

RPMパッケージファイルは以下の要素で構成されています：
- **メタデータ**: パッケージ名、バージョン、説明、依存関係
- **ファイル**: 実際のプログラムファイルやドキュメント
- **スクリプト**: インストール前後に実行される処理
- **署名**: パッケージの整合性を保証するデジタル署名

## 主なコマンド

### インストールとアップグレード
- **インストール**: `rpm -i <パッケージ.rpm>` – 新しいパッケージを追加
- **強制インストール**: `rpm -i --force <パッケージ.rpm>` – 競合があっても強制的にインストール
- **アップグレード**: `rpm -U <パッケージ.rpm>` – 既存パッケージの更新（なければインストール）
- **フレッシュ**: `rpm -F <パッケージ.rpm>` – 既存パッケージのみ更新

### 削除
- **削除**: `rpm -e <パッケージ名>` – インストール済みパッケージを削除
- **依存関係を無視して削除**: `rpm -e --nodeps <パッケージ名>`

### クエリ（情報表示）
- **インストール確認**: `rpm -q <パッケージ名>` – パッケージのインストール状況
- **全パッケージ一覧**: `rpm -qa` – インストール済み全パッケージ
- **パッケージ情報**: `rpm -qi <パッケージ名>` – 詳細情報の表示
- **ファイル一覧**: `rpm -ql <パッケージ名>` – パッケージ内のファイル一覧
- **設定ファイル一覧**: `rpm -qc <パッケージ名>` – 設定ファイルのみ表示
- **ドキュメント一覧**: `rpm -qd <パッケージ名>` – ドキュメントファイルのみ表示
- **依存関係**: `rpm -qR <パッケージ名>` – パッケージが必要とする依存関係
- **ファイル所有者**: `rpm -qf <ファイルパス>` – ファイルを含むパッケージを特定

### 検証
- **ファイル検証**: `rpm -V <パッケージ名>` – ファイルの整合性チェック
- **全パッケージ検証**: `rpm -Va` – 全インストール済みパッケージの検証
- **パッケージ署名確認**: `rpm -K <パッケージ.rpm>` – パッケージファイルの署名検証

### データベース操作
- **データベース再構築**: `rpm --rebuilddb` – RPMデータベースの再構築
- **データベース初期化**: `rpm --initdb` – RPMデータベースの初期化

## よく使用されるオプション

- **-v**: 詳細表示（verbose）
- **-h**: プログレスバー表示（hash marks）
- **--test**: 実際の処理は行わず、テストのみ実行
- **--nodeps**: 依存関係のチェックを無視
- **--force**: 競合や問題があっても強制実行
- **--quiet**: エラー以外の出力を抑制

## RPMデータベース

RPMは`/var/lib/rpm/`ディレクトリにデータベースを保持し、インストール済みパッケージの情報を管理します。このデータベースが破損した場合は`--rebuilddb`オプションで再構築できます。

## 使用例

```bash
# パッケージの詳細情報を表示
rpm -qi firefox

# システムにインストールされているkernelパッケージを一覧
rpm -qa | grep kernel

# 特定のファイルがどのパッケージに含まれるかを確認
rpm -qf /usr/bin/vim

# パッケージの検証（改ざんチェック）
rpm -V openssh-server

# パッケージファイルの内容をインストール前に確認
rpm -qpl package.rpm
```

## 注意点

rpmコマンドは低レベルなツールのため、以下の点に注意が必要です：
- 依存関係の自動解決は行わない
- パッケージの競合を自動的には解決しない
- 通常の運用では[[yum]]や[[dnf]]の使用が推奨される
- 強制オプション（--force）の使用は慎重に行う

